RewriteEngine On

# 1) Do not rewrite existing files or directories
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# 2) Do not touch requests that already include .php
RewriteCond %{REQUEST_URI} \.php$ [NC]
RewriteRule ^ - [L]

# 3) Only rewrite extensionless URLs to .php if that .php file exists
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME}\.php -f
RewriteRule ^(.+)$ $1.php [L,QSA]